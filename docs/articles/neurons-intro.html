<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to neurons and neuronlists • nat</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to neurons and neuronlists">
<meta property="og:description" content="nat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.8.18</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Installation.html">Installation Details</a>
    </li>
    <li>
      <a href="../articles/neurons-intro.html">Introduction to neurons and neuronlists</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/natverse/nat/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="neurons-intro_files/header-attrs-2.10/header-attrs.js"></script><script src="neurons-intro_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="neurons-intro_files/rglWebGL-binding-0.107.10/rglWebGL.js"></script><link href="neurons-intro_files/rglwidgetClass-0.107.10/rgl.css" rel="stylesheet">
<script src="neurons-intro_files/rglwidgetClass-0.107.10/rglClass.min.js"></script><script src="neurons-intro_files/CanvasMatrix4-0.107.10/CanvasMatrix.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to neurons and neuronlists</h1>
                        <h4 class="author">Gregory Jefferis</h4>
            
            <h4 class="date">2021-09-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/natverse/nat/blob/master/vignettes/neurons-intro.Rmd"><code>vignettes/neurons-intro.Rmd</code></a></small>
      <div class="hidden name"><code>neurons-intro.Rmd</code></div>

    </div>

    
    
<div id="preface" class="section level2">
<h2 class="hasAnchor">
<a href="#preface" class="anchor"></a>Preface</h2>
<p>This vignette is designed to give you a good introduction to some of the key features of nat by teaching you about how it handles individual neurons and collections of neurons.</p>
<p>The source code for this vignette is available at <a href="https://github.com/natverse/nat/blob/master/vignettes/neurons-intro.Rmd" class="uri">https://github.com/natverse/nat/blob/master/vignettes/neurons-intro.Rmd</a>. If you find something unclear or notice a typo, I would be very happy if you would click on the Pencil Icon on that page or follow <a href="https://github.com/natverse/nat/edit/master/vignettes/neurons-intro.Rmd">this link to edit</a> and suggest an alternative wording. Don’t be shy about doing this; I have to review any change and even if your suggestion is not perfect it will still be a prompt for me to improve this document. Thank you!</p>
</div>
<div id="startup" class="section level2">
<h2 class="hasAnchor">
<a href="#startup" class="anchor"></a>Startup</h2>
<p>Install the package if required</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'nat'</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Load the package</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/natverse/nat">nat</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="neurons-and-neuronlists" class="section level2">
<h2 class="hasAnchor">
<a href="#neurons-and-neuronlists" class="anchor"></a>Neurons and Neuronlists</h2>
<p>There are a number of basic built in types of data in R such as vectors and matrices, but it is also very easy to define new data types with specialised features to enable powerful and efficient analysis of particular kinds of data. These specialised data types are called <em>classes</em> and a specific instance of a class is an <em>object</em> (a neuroscience analogy: this is the difference between talking about the general class of mitral cells and the specific cell that you just sealed onto with your patch clamp electrode.)</p>
<p>We will look at two key classes that <strong>nat</strong> defines for handling 3D structures of neurons</p>
<ul>
<li><code>neuron</code></li>
<li><code>neuronlist</code></li>
</ul>
<div id="sample-data" class="section level3">
<h3 class="hasAnchor">
<a href="#sample-data" class="anchor"></a>Sample Data</h3>
<p>As an example we’re going to look at a data set of olfactory projection neurons originally published as Supplemental Information to accompany <a href="http://dx.doi.org/10.1016/j.cell.2007.01.040">Jefferis, Potter et al, Cell (2007)</a>. A subset of the original data are distributed as a sample data object with the <strong>nat</strong> package, which we can load like so.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"Cell07PNs"</span><span class="op">)</span></code></pre></div>
<p>For more information about these data see <a href="http://natverse.org/nat/reference/Cell07PNs.html">Cell07PNs</a>.</p>
<p>This <code>Cell07PNs</code> object has two classes <code>neuronlist</code> and the base class <code>list</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "neuronlist" "list"</code></pre>
<p>Many R objects inherit from the base class <code>list</code> (objects can have multiple classes in the same way that a mitral cell is also neuron) because this is a convenient container class into which you can put a variety of different kinds of data. In this case the <code>Cell07PNs</code> <code>neuronlist</code> contains 40 objects:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 40</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># access the first neuron in the neuronlist</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "neuron" "list"</code></pre>
<p>each representing a traced neuron. We will now look in detail at these two classes.</p>
</div>
</div>
<div id="neurons" class="section level2">
<h2 class="hasAnchor">
<a href="#neurons" class="anchor"></a>Neurons</h2>
<p>We start by extracting the first neuron in Cell07PNs, and assigning it to a variable. We can then plot the neuron so that we have an image of what we are talking about.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n1</span><span class="op">=</span><span class="va">Cell07PNs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">n1</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
<div id="neuron-internal-structure" class="section level3">
<h3 class="hasAnchor">
<a href="#neuron-internal-structure" class="anchor"></a>Neuron internal structure</h3>
<p>The <code>str</code> function (short for structure) allows us to take a look at the internal structure of this neuron object.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use =1 so that we don't show complete structure</span>
<span class="co"># for objects inside n1</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">n1</span>, max.level<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## List of 24
##  $ CellType     : chr "DA1"
##  $ NeuronName   : chr "EBH11R"
##  $ InputFileName: 'AsIs' chr "/GD/projects/PN2/TransformedTraces/DA1/EBH11R.tasc"
##  $ CreatedAt    : POSIXt[1:1], format: "2006-01-17 15:21:14"
##  $ NodeName     : Named chr "jefferis.joh.cam.ac.uk"
##   ..- attr(*, "names")= chr "nodename"
##  $ InputFileStat:'data.frame':   1 obs. of  10 variables:
##  $ InputFileMD5 : Named chr "fcacee3f874cbe2c6ad96214e6fee337"
##   ..- attr(*, "names")= 'AsIs' chr "/GD/projects/PN2/TransformedTraces/DA1/EBH11R.tasc"
##  $ NumPoints    : int 180
##  $ StartPoint   : num 1
##  $ BranchPoints : num [1:16] 34 48 51 75 78 95 98 99 108 109 ...
##  $ EndPoints    : num [1:18] 1 42 59 62 80 85 96 100 102 112 ...
##  $ NumSegs      : int 33
##  $ SegList      :List of 33
##  $ d            :'data.frame':   180 obs. of  7 variables:
##  $ OrientInfo   :List of 5
##  $ SegOrders    : num [1:33] 1 2 2 3 4 4 3 4 5 5 ...
##  $ MBPoints     : int [1:2] 34 48
##  $ LHBranchPoint: int 75
##  $ SegTypes     : num [1:33] 1 3 1 3 3 3 1 2 2 2 ...
##  $ AxonSegNos   :List of 3
##  $ LHSegNos     : num [1:26] 8 9 10 11 12 13 14 15 16 17 ...
##  $ MBSegNos     :List of 2
##  $ NumMBBranches: num 2
##  $ AxonLHEP     : num 72
##  - attr(*, "class")= chr [1:2] "neuron" "list"</code></pre>
<p>From this you can see that there are a large number of fields inside the neuron. Each field can be accessed using the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> or <code><a href="https://rdrr.io/r/base/Extract.html">[[</a></code> operators</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n1</span><span class="op">$</span><span class="va">NumPoints</span></code></pre></div>
<pre><code>## [1] 180</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n1</span><span class="op">[[</span><span class="st">"NumPoints"</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] 180</code></pre>
<p>There are a set of core fields (described in <code><a href="../reference/neuron.html">?neuron</a></code> documentation); the key ones will be described shortly. However there are also quite a few user fields in this neuron and you can safely add any field you like so long as its name does not clash with an existing field. For example:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n1</span><span class="op">$</span><span class="va">Comment</span><span class="op">=</span><span class="st">'The sex of this specimen is uncertain'</span></code></pre></div>
<p>The single most important field in a neuron is the <code>$d</code> <code>data.frame</code>. This contains a block of data closely reminiscent of the SWC data format for traced neurons:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">n1</span><span class="op">$</span><span class="va">d</span><span class="op">)</span></code></pre></div>
<pre><code>## 'data.frame':    180 obs. of  7 variables:
##  $ PointNo: int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Label  : num  2 2 2 2 2 2 2 2 2 2 ...
##  $ X      : num  187 187 188 188 188 ...
##  $ Y      : num  133 131 130 129 129 ...
##  $ Z      : num  88.2 90.6 93.1 95 97.5 ...
##  $ W      : num  1.01 1.27 1.14 1.27 1.27 1.27 1.27 1.27 1.27 1.27 ...
##  $ Parent : num  -1 1 2 3 4 5 6 7 8 9 ...</code></pre>
<p>Each row defines a node in a branched tree with a unique integer identifier, <code>PointNo</code>, normally but not always sequentially numbered from 1. The <code>X,Y,Z</code> columns encode the position of each vertex and the <code>W</code> column encodes the diameter of the neurite at that position.</p>
</div>
<div id="methods-for-neurons" class="section level3">
<h3 class="hasAnchor">
<a href="#methods-for-neurons" class="anchor"></a>Methods for neurons</h3>
<p>R’s simple <a href="http://adv-r.had.co.nz/OO-essentials.html">S3 object oriented system</a> allows specialised functions for particular classes to be defined. These functions tailored to a particular class are called <em>methods</em>. Methods can be provided for pre-existing functions supplied with base R as well as new user-written functions. The system is quite simple. If a function <code>foo</code> is defined as a <em>generic</em> function then you can define new functions called <code>foo.bar</code> that will be called when you write <code>foo(x)</code> and <code>x</code> has class `bar.</p>
<p>We already used one such method without comment, <code>plot.neuron</code>. There is a base R function called <code>plot</code>. nat defines a new function called <code>plot.neuron</code>, which R interprets as a <code>plot</code> method specialised for <code>neuron</code> objects. When the base R <code>plot</code> function is called, it looks at the class of its first object to see whether a specialised method exists. If there is none, it will use a fallback method called <code>plot.default</code>.</p>
<p>The <code>plot.neuron</code> method interprets the branching structure of a neuron and draws line segments joining up the connected nodes at the appropriate 2D positions. You can compare it with what you would get if you just plotted the XY position of all nodes joined together by a single line:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">n1</span><span class="op">$</span><span class="va">d</span><span class="op">$</span><span class="va">X</span>, <span class="va">n1</span><span class="op">$</span><span class="va">d</span><span class="op">$</span><span class="va">Y</span>, type <span class="op">=</span> <span class="st">'l'</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-11-1.png" width="480"></p>
<p>You can find out what methods are available for a particular class like so:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/methods.html">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">'neuron'</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] all.equal          as.neuron          as.ngraph          as.seglist        
##  [5] branchpoints       dotprops           endpoints          intersect_plane   
##  [9] ndigest            nvertices          Ops                plot              
## [13] plot3d             potential_synapses print              prune_in_volume   
## [17] prune_online       prune_twigs        prune              reroot            
## [21] resample           rootpoints         scale              sholl_analysis    
## [25] subset             summary            write.vtk          xform             
## [29] xyzmatrix          xyzmatrix&lt;-       
## see '?methods' for accessing help and source code</code></pre>
<p>You can then find the help page for any method in the console with <code><a href="../reference/plot.neuron.html">?plot.neuron</a></code>. Note that if you write <code><a href="https://rdrr.io/r/graphics/plot.default.html">?plot</a></code> you will get the documentation for the basic <code>plot</code> function supplied with R.</p>
<p>It is also good idea to look at <a href="http://natverse.org/nat/reference/index.html">nat’s function reference page</a> which groups available functions into categories that often reflect the class of object they can work on.</p>
<p>In R, operators such as <code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code> or <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> are actually special functions with two arguments, so one can add methods for these in the same way. In the following example we use this arithmetic to shift a neuron by a small amount:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">n1</span>, col <span class="op">=</span> <span class="st">'black'</span>, WithNodes <span class="op">=</span> <span class="cn">F</span>, main<span class="op">=</span><span class="st">"Shifting neurons"</span><span class="op">)</span>
<span class="co"># shift by 3 microns in x,y,z</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">n1</span><span class="op">+</span><span class="fl">3</span>, col <span class="op">=</span> <span class="st">'red'</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, WithNodes <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="co"># shift by -5 microns in y</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">n1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">-</span><span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'blue'</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, WithNodes <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-13-1.png" width="480"></p>
<p>Another specialised method is <code>subset.neuron</code> which we can use to extract part of a neuron into a new object. For example, a simple spatial criterion, X location must be &gt;240, is used to extract the axon terminal arborisation field in this example</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">n1</span>, col <span class="op">=</span> <span class="st">'black'</span>, WithAllPoints <span class="op">=</span> <span class="cn">T</span>, main<span class="op">=</span><span class="st">"Subsetting a neuron"</span><span class="op">)</span>
<span class="co"># keep only nodes with X position &gt;20</span>
<span class="va">n1.lh</span><span class="op">=</span><span class="fu"><a href="../reference/subset.html">subset</a></span><span class="op">(</span><span class="va">n1</span>, <span class="va">X</span><span class="op">&gt;</span><span class="fl">240</span><span class="op">)</span>
<span class="co"># plot the selected part of the neuron in blue</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">n1.lh</span>, col<span class="op">=</span><span class="st">'blue'</span>, lwd<span class="op">=</span><span class="fl">3</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># add a line illustrating the cut point</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">240</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-14-1.png" width="480"></p>
<p>We can also summarise the morphological properties of a neuron using the <code>summary.neuron</code> method, which allows us to compare measurements for the original neuron and the axon arbour that we just cut out above.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/summary.neuronlist.html">summary</a></span><span class="op">(</span><span class="va">n1</span><span class="op">)</span></code></pre></div>
<pre><code>##   root nodes segments branchpoints endpoints cable.length nTrees
## 1    1   180       33           16        18     297.1763      1</code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/summary.neuronlist.html">summary</a></span><span class="op">(</span><span class="va">n1.lh</span><span class="op">)</span></code></pre></div>
<pre><code>##   root nodes segments branchpoints endpoints cable.length nTrees
## 1    1   111       27           13        15     156.7654      1</code></pre>
<p>See <a href="http://natverse.org/nat/reference/index.html">nat’s function reference page</a> for additional functions for working with neurons.</p>
</div>
</div>
<div id="neuronlists" class="section level2">
<h2 class="hasAnchor">
<a href="#neuronlists" class="anchor"></a>Neuronlists</h2>
<p>The <code>data</code> statement above loaded a <code>neuronlist</code> object called <code>Cell07PNs</code> containing 40 <code>neuron</code> objects. <code>neuronlist</code> objects are key data structures in nat for convenient handling of collections of neurons.</p>
<div class="figure">
<img src="fig/neuronlist-01.png" alt=""><p class="caption">Structure of neuronlist objects</p>
</div>
<p>The diagram above presents the structure of a neuronlist, <code>x</code>, which contains 5 neurons. The main structure is an R <code>list</code> object, which in this case contains 5 slots. Each slot contains a neuron with a unique name. In addition to this list of neurons there is an optional attached <code>data.frame</code> (another standard R class). When present, each neuron in the main list must have a matching row in this <code>data.frame</code>.</p>
<p>Neuronlists can be manipulated use the square bracket subscript operator to extract or replace a subset of their elements. Crucially when this happens the corresponding rows of the attached metadata are also selected as diagrammed for the result of x[1:3] (right hand side of figure above).</p>
<p>When subscripting any list in R, it is very important to understand the difference between using the single and double bracket operator. We can illustrate this difference as follows:</p>
<div class="figure">
<img src="fig/neuronlist-subsets-01.png" alt=""><p class="caption">The difference between single and double bracket subscript operators</p>
</div>
<p>The single bracket operator makes a new list containing a specified subset of elements in the original list, while the double bracket operator extracts the object at the given position. So in the figure <code>x[1]</code> is a <code>neuronlist</code> object of length 1, whereas <code>x[[1]]</code> is the <code>neuron</code> object at the first position in the list.</p>
<div id="worked-examples" class="section level3">
<h3 class="hasAnchor">
<a href="#worked-examples" class="anchor"></a>Worked Examples</h3>
<p>Let us start by extracting the first five neurons from our sample data.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># we can select neurons by indexing </span>
<span class="va">first5</span><span class="op">=</span><span class="va">Cell07PNs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>
<span class="fu"><a href="../reference/summary.neuronlist.html">summary</a></span><span class="op">(</span><span class="va">first5</span><span class="op">)</span></code></pre></div>
<pre><code>##        root nodes segments branchpoints endpoints cable.length nTrees
## EBH11R    1   180       33           16        18     297.1763      1
## EBH20L    1   200       26           12        15     327.0929      1
## EBH20R    1   199       25           12        14     347.6153      1
## EBI12L    1   169       23           11        13     294.4680      1
## EBI22R    1   160       27           13        15     303.0150      1</code></pre>
<p>Each neuron in the neuronlist has an associated name which can be used to select it. We can get the names of all neurons using the <code>names</code> function.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "EBH11R" "EBH20L" "EBH20R" "EBI12L" "EBI22R" "EBJ23L" "EBJ3R"  "EBN19L"
##  [9] "EBO15L" "EBO53L" "ECA34L" "ECB3L"  "LI23L"  "LIC2R"  "LJ5L"   "MC3B"  
## [17] "MH16L"  "MM14L"  "NA7L"   "NH15L"  "NH29B"  "NI16L"  "NIA8L"  "NIA8R" 
## [25] "NNA9L"  "NNC4R"  "NNE1L"  "OFD2L"  "OKC9R"  "SDD8L"  "SH21L"  "SL20L" 
## [33] "TKC8R"  "TL4R"   "TS7L"   "TT27R"  "VA15R"  "VA20R"  "VB37L"  "VB58L"</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nl3</span><span class="op">=</span><span class="va">Cell07PNs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"EBH11R"</span>, <span class="st">"EBH20L"</span>, <span class="st">"EBH20R"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span><span class="op">(</span><span class="va">nl3</span>, <span class="va">Cell07PNs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>You can also use the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator to access a single neuron e.g. <code>Cell07PNs$EBH11R</code>. This can be quite useful when working interactively in the console because RStudio will offer to autocomplete the neuron name when you start typing past the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> symbol, but is not recommended for scripts.</p>
</div>
<div id="metadata" class="section level3">
<h3 class="hasAnchor">
<a href="#metadata" class="anchor"></a>Metadata</h3>
<p>The names of neurons are also used to index a <code>data.frame</code> object attached to the neuronlist with one row for each neuron. You can use the <code>head</code> function to give a summary of the attached metadata in this neuronlist. Using the <code>as.data.frame</code> method on a neuronlist allows you to extract this attached metadata to a separate object.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/neuronlist-dataframe-methods.html">head</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">)</span></code></pre></div>
<pre><code>##         Brain RegistrationScore Notes Glomerulus Batch Directory Traced
## EBH11R EBH11R                 4              DA1   PN2    unsure    yes
## EBH20L EBH20L                 4              DL3   PN2   unsure2    yes
## EBH20R EBH20R                 4              DA1   PN2   unsure2    yes
## EBI12L EBI12L                 4              DA1   PN2   unsure3    yes
## EBI22R EBI22R                 4              DL3   PN2   unsure3    yes
## EBJ23L EBJ23L                 4              DL3   PN2   unsure4    yes
##        Scored.By Sex Include     ID HaveWarp HaveAsc
## EBH11R       ACH   M         EBH11R     TRUE    TRUE
## EBH20L       ACH             EBH20L     TRUE    TRUE
## EBH20R       ACH   M         EBH20R     TRUE    TRUE
## EBI12L       ACH   F         EBI12L     TRUE    TRUE
## EBI22R       ACH             EBI22R     TRUE    TRUE
## EBJ23L       ACH             EBJ23L     TRUE    TRUE
##                                                 TraceFile AscBatch Status
## EBH11R /GD/projects/PN2/TransformedTraces/DA1/EBH11R.tasc      New       
## EBH20L /GD/projects/PN2/TransformedTraces/DL3/EBH20L.tasc      New       
## EBH20R /GD/projects/PN2/TransformedTraces/DA1/EBH20R.tasc      New       
## EBI12L /GD/projects/PN2/TransformedTraces/DA1/EBI12L.tasc      New       
## EBI22R /GD/projects/PN2/TransformedTraces/DL3/EBI22R.tasc      New       
## EBJ23L /GD/projects/PN2/TransformedTraces/DL3/EBJ23L.tasc      New       
##        GlomSeq NumNAs MBP1 MBP2 LHBP PNType Seq nTrees StartPoint
## EBH11R       1      0   34   48   75    iPN  13      1          1
## EBH20L       1      0   29   29   77    iPN  15      1          1
## EBH20R       2      0   24   80  147    iPN  16      1          1
## EBI12L       3      0   29   59   89    iPN  18      1          1
## EBI22R       2      0   34   34   56    iPN  20      1          1
## EBJ23L       3      0   23   23   52    iPN  21      1          1
##                  CreatedAt
## EBH11R 2006-01-17 15:21:14
## EBH20L 2006-01-17 15:21:14
## EBH20R 2006-01-17 15:21:14
## EBI12L 2006-01-17 15:21:15
## EBI22R 2006-01-17 15:21:15
## EBJ23L 2006-01-17 15:21:15
##                                                                                             WarpFile
## EBH11R  /GD/projects/PN2/allreg/warp/unsure/average-goodbrains_EBH11R101_warp_m0g40c4e1e-1x16r3.list
## EBH20L /GD/projects/PN2/allreg/warp/unsure2/average-goodbrains_EBH20L101_warp_m0g40c4e1e-1x16r3.list
## EBH20R /GD/projects/PN2/allreg/warp/unsure2/average-goodbrains_EBH20R101_warp_m0g40c4e1e-1x16r3.list
## EBI12L /GD/projects/PN2/allreg/warp/unsure3/average-goodbrains_EBI12L101_warp_m0g40c4e1e-1x16r3.list
## EBI22R /GD/projects/PN2/allreg/warp/unsure3/average-goodbrains_EBI22R101_warp_m0g40c4e1e-1x16r3.list
## EBJ23L /GD/projects/PN2/allreg/warp/unsure4/average-goodbrains_EBJ23L101_warp_m0g40c4e1e-1x16r3.list</code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 40</code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># rownames of data.frame are the same as names of Cell07PNs list.</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>You can use columns in the attached metadata in expressions that select or operate on the neurons in the list. In the next two examples we</p>
<ul>
<li>
<code>subset</code> the neurons in a neuronlist based on a metadata column</li>
<li>use the <code>with</code> function to carry out a calculation using column(s) of metadata.</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># subset.neuronlist method (which you call using the subset function)</span>
<span class="va">da1n</span><span class="op">=</span><span class="fu"><a href="../reference/subset.html">subset</a></span><span class="op">(</span><span class="va">Cell07PNs</span>, <span class="va">Glomerulus</span><span class="op">==</span><span class="st">"DA1"</span><span class="op">)</span>

<span class="co"># with.neuronlist method</span>
<span class="fu"><a href="../reference/neuronlist-dataframe-methods.html">with</a></span><span class="op">(</span><span class="va">Cell07PNs</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">Glomerulus</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Glomerulus
##  DA1  DL3 DP1m VA1d 
##   11   10    8   11</code></pre>
<p>There is a second approach to accessing this attached metadata data.frame, using the square bracket operator with two arguments as used for subscripting (2D) matrices or <code>data.frames</code>. For example we can access the <code>Glomerulus</code> column like so:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Cell07PNs</span><span class="op">[</span>, <span class="st">'Glomerulus'</span><span class="op">]</span></code></pre></div>
<pre><code>##  [1] DA1  DL3  DA1  DA1  DL3  DL3  VA1d VA1d VA1d VA1d DP1m DP1m DA1  DL3  VA1d
## [16] VA1d DL3  DA1  DA1  VA1d VA1d VA1d DL3  VA1d DP1m DP1m DP1m DP1m DP1m DP1m
## [31] DA1  DL3  DL3  DL3  VA1d DA1  DA1  DA1  DL3  DA1 
## Levels: DA1 DL3 DP1m VA1d</code></pre>
<p>This approach has some features that make for additional flexibility. For example you can acess the whole data.frame like so:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/summary.neuronlist.html">summary</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">[</span>,<span class="op">]</span><span class="op">)</span></code></pre></div>
<p>The form <code>[,]</code> which includes a comma implies two (missing) arguments. <strong>nat</strong> therefore interprets this as request for the 2D data.frame attached to Cell07PNs rather than the neuronlist itself. You can also use this notation to add new columns or modify existing columns in place.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Cell07PNs</span><span class="op">[</span>, <span class="st">'NewColumn'</span><span class="op">]</span> <span class="op">=</span> <span class="va">somevariable</span>
<span class="va">Cell07PNs</span><span class="op">[</span>, <span class="st">"Sex"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"female"</span>, <span class="va">Cell07PNs</span><span class="op">[</span>, <span class="st">"Sex"</span><span class="op">]</span><span class="op">)</span>
<span class="va">Cell07PNs</span><span class="op">[</span>, <span class="st">"Sex"</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"male"</span>, <span class="va">Cell07PNs</span><span class="op">[</span>, <span class="st">"Sex"</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>You can also access selected rows of the data.frame in the normal way:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Cell07PNs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"Glomerulus"</span><span class="op">]</span>
<span class="va">Cell07PNs</span><span class="op">[</span><span class="va">Cell07PNs</span><span class="op">[</span>, <span class="st">"Sex"</span><span class="op">]</span><span class="op">==</span><span class="st">"F"</span>, <span class="st">"Glomerulus"</span><span class="op">]</span></code></pre></div>
</div>
<div id="working-on-all-the-neurons-in-a-neuronlist" class="section level3">
<h3 class="hasAnchor">
<a href="#working-on-all-the-neurons-in-a-neuronlist" class="anchor"></a>Working on all the neurons in a neuronlist</h3>
<p>There are quite a few methods defined for the <code>neuronlist</code> class:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/methods.html">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"neuronlist"</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] -                  [                  [&lt;-                *                 
##  [5] /                  +                  as.data.frame      as.neuronlistfh   
##  [9] c                  data.frame&lt;-       dimnames           dotprops          
## [13] droplevels         head               intersect          mirror            
## [17] nvertices          plot               plot3d             potential_synapses
## [21] print              prune_in_volume    prune_online       prune_twigs       
## [25] prune              reroot             resample           setdiff           
## [29] sholl_analysis     subset             summary            tail              
## [33] union              with               xform              xyzmatrix         
## [37] xyzmatrix&lt;-       
## see '?methods' for accessing help and source code</code></pre>
<p>For example we can scale the position (and diameter) of all of the neurons in a neuronlist using the <code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code> operator:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># convert from microns to nm</span>
<span class="va">Cell07PNs.nm</span> <span class="op">=</span> <span class="va">Cell07PNs</span><span class="op">*</span><span class="fl">1e3</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Cell07PNs.nm</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-25-1.png" width="480"></p>
<p>There is also a more powerful <code>xform</code> function that allows arbitrary transformations to be applied. For example here we apply a 3D rotation expressed as a homogeneous affine matrix:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define a 180 degree rotation around the x axis</span>
<span class="va">rotm</span><span class="op">=</span><span class="fu"><a href="../reference/cmtkparams2affmat.html">cmtkparams2affmat</a></span><span class="op">(</span>rx<span class="op">=</span><span class="fl">180</span><span class="op">)</span>
<span class="co"># remove tiny values due to rounding errors</span>
<span class="va">rotm</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/zapsmall.html">zapsmall</a></span><span class="op">(</span><span class="va">rotm</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/xform.html">xform</a></span><span class="op">(</span><span class="va">Cell07PNs</span>, <span class="va">rotm</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-26-1.png" width="480"></p>
<p>More generally any function that works on a neuron can be applied to a neuronlist by using the function <code>nlapply</code>. This is an analogue to base R’s <code>lapply</code> function. This will take care of returning a new neuronlist with the attached metadata and includes additional features such as error tolerance, progress bars and parallelisation for multi-core machines. It is worth reviewing the help and examples for this function carefully if you start to work regularly with neuronlists.</p>
</div>
</div>
<div id="plots" class="section level2">
<h2 class="hasAnchor">
<a href="#plots" class="anchor"></a>Plots</h2>
<p>We have already seen that we can plot a single neuron (the first) like so:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-27-1.png" width="768"></p>
<p>The purple node higlights the root or soma of the neuron, red nodes are branch points, green nodes are end points. We can also label each node with its <code>PointNo</code> index.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col<span class="op">=</span><span class="st">'red'</span>, WithText<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-28-1.png" width="768"></p>
<p>Multiple neurons can be plotted by passing a whole neuronlist or indexing it</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-29-1.png" width="768"></p>
<p>More complex subsets are possible by using <code>plot.neuronlist</code> subset argument (which works in the same way as the <code>subset.neuronlist</code> function). For example here we select neurons by which olfactory glomeruli their dendrites occupy:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Cell07PNs</span>, subset<span class="op">=</span><span class="va">Glomerulus</span><span class="op">!=</span><span class="st">"DA1"</span>, col<span class="op">=</span><span class="st">'grey'</span>, WithNodes<span class="op">=</span><span class="cn">F</span>, main<span class="op">=</span><span class="st">"DA1 neurons"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Cell07PNs</span>, subset<span class="op">=</span><span class="va">Glomerulus</span><span class="op">==</span><span class="st">"DA1"</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-30-1.png" width="480"></p>
<div id="d-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#d-plots" class="anchor"></a>3D plots</h3>
<p>So far we have only used 2D plots in this document, but especially for interactive analysis and exploration, it is much more helpful to have 3D plots that can be rotated, zoomed etc. <strong>nat</strong> provides numerous functions for <a href="http://natverse.org/nat/reference/index.html#section--d-plotting-of-objects">3D plots</a> based on the <a href="https://cran.r-project.org/package=rgl">rgl package</a>. It is actually possible to embed fully interactive 3d figures in <a href="https://rmarkdown.rstudio.com/">rmarkdown</a> reports like this one by setting the <a href="https://CRAN.R-project.org/package=rgl/vignettes/WebGL.html">webgl chunk option</a>.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">clear3d</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot3d.html">plot3d</a></span><span class="op">(</span><span class="va">Cell07PNs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
<span class="co"># set a grey background so it's easier to see extent of the webgl canvas</span>
<span class="fu">bg3d</span><span class="op">(</span>col<span class="op">=</span><span class="st">'lightgrey'</span><span class="op">)</span></code></pre></div>
<div id="rgl29320" style="width:480px;height:432.632880098888px;" class="rglWebGL html-widget"></div>
<script type="application/json" data-for="rgl29320">{"x":{"material":{"color":"#000000","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":true,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0],"margin":"","floating":false},"rootSubscene":7,"objects":{"13":{"id":13,"type":"points","material":{"lit":false},"vertices":[[220.98664855957,100.98698425293,146.357559204102],[228.44807434082,95.4461364746094,144.936141967773],[227.528900146484,92.0755767822266,147.085800170898],[250.583908081055,96.9142990112305,138.607391357422],[250.374450683594,94.3393630981445,137.6201171875],[263.807434082031,99.7057647705078,122.817092895508],[266.267333984375,100.097373962402,118.329460144043],[266.755706787109,99.1845474243164,116.430130004883],[272.031951904297,104.97306060791,104.867286682129],[272.292327880859,104.184257507324,102.967262268066],[274.804351806641,102.846878051758,103.3134765625],[277.783020019531,103.363876342773,103.35107421875],[272.748596191406,105.580902099609,104.197692871094],[278.978912353516,101.788757324219,99.9844970703125],[278.77392578125,109.390472412109,104.379333496094],[282.149841308594,110.003799438477,105.451210021973],[224.706741333008,109.863616943359,153.587493896484],[229.634338378906,92.3063659667969,157.296997070312],[226.885482788086,90.3632507324219,147.59602355957],[249.886367797852,93.5907897949219,136.777954101562],[253.009902954102,90.9490432739258,137.349212646484],[264.080108642578,98.5338973999023,121.894630432129],[266.322326660156,98.7324066162109,116.46558380127],[267.545959472656,98.5985946655273,112.856079101562],[271.076171875,102.672882080078,100.849548339844],[274.612823486328,100.920608520508,103.287719726562],[277.391998291016,102.191482543945,102.694732666016],[287.121398925781,101.433647155762,103.307395935059],[281.795806884766,96.6398696899414,101.080749511719],[276.655090332031,95.0980911254883,99.2211303710938],[278.328735351562,113.756271362305,104.876998901367],[282.306945800781,111.93212890625,105.654922485352],[289.536407470703,111.960144042969,109.182807922363],[186.86604309082,132.709320068359,88.2039337158203]],"colors":[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0,0,1,1],[0.627451002597809,0.125490203499794,0.941176474094391,1]],"centers":[[220.98664855957,100.98698425293,146.357559204102],[228.44807434082,95.4461364746094,144.936141967773],[227.528900146484,92.0755767822266,147.085800170898],[250.583908081055,96.9142990112305,138.607391357422],[250.374450683594,94.3393630981445,137.6201171875],[263.807434082031,99.7057647705078,122.817092895508],[266.267333984375,100.097373962402,118.329460144043],[266.755706787109,99.1845474243164,116.430130004883],[272.031951904297,104.97306060791,104.867286682129],[272.292327880859,104.184257507324,102.967262268066],[274.804351806641,102.846878051758,103.3134765625],[277.783020019531,103.363876342773,103.35107421875],[272.748596191406,105.580902099609,104.197692871094],[278.978912353516,101.788757324219,99.9844970703125],[278.77392578125,109.390472412109,104.379333496094],[282.149841308594,110.003799438477,105.451210021973],[224.706741333008,109.863616943359,153.587493896484],[229.634338378906,92.3063659667969,157.296997070312],[226.885482788086,90.3632507324219,147.59602355957],[249.886367797852,93.5907897949219,136.777954101562],[253.009902954102,90.9490432739258,137.349212646484],[264.080108642578,98.5338973999023,121.894630432129],[266.322326660156,98.7324066162109,116.46558380127],[267.545959472656,98.5985946655273,112.856079101562],[271.076171875,102.672882080078,100.849548339844],[274.612823486328,100.920608520508,103.287719726562],[277.391998291016,102.191482543945,102.694732666016],[287.121398925781,101.433647155762,103.307395935059],[281.795806884766,96.6398696899414,101.080749511719],[276.655090332031,95.0980911254883,99.2211303710938],[278.328735351562,113.756271362305,104.876998901367],[282.306945800781,111.93212890625,105.654922485352],[289.536407470703,111.960144042969,109.182807922363],[186.86604309082,132.709320068359,88.2039337158203]],"ignoreExtent":false,"flags":34816},"14":{"id":14,"type":"linestrip","material":{"lit":false},"vertices":[[186.86604309082,132.709320068359,88.2039337158203],[187.335464477539,131.155807495117,90.5968017578125],[188.116500854492,130.254455566406,93.1432571411133],[188.468032836914,129.475662231445,94.973991394043],[188.287521362305,128.754165649414,97.4562072753906],[188.27326965332,127.956718444824,99.1680145263672],[188.455825805664,127.570365905762,101.539924621582],[188.999694824219,127.539924621582,103.695404052734],[189.638244628906,126.617607116699,104.953994750977],[189.418548583984,126.125122070312,108.076599121094],[189.598403930664,125.061378479004,110.217002868652],[190.178070068359,124.265014648438,111.877548217773],[190.728012084961,123.479652404785,113.63053894043],[190.993560791016,122.456298828125,116.218589782715],[191.16667175293,121.14119720459,118.817932128906],[191.57307434082,119.000396728516,121.628929138184],[192.271179199219,116.622085571289,122.814872741699],[193.053131103516,115.116348266602,125.263648986816],[194.768920898438,112.995140075684,128.049270629883],[195.911666870117,112.014183044434,129.455596923828],[197.163696289062,111.617515563965,131.918121337891],[198.820327758789,110.203086853027,133.30647277832],[199.980117797852,108.940093994141,134.333465576172],[201.414489746094,108.122100830078,136.253784179688],[202.689422607422,106.68350982666,136.04573059082],[205.341003417969,105.654823303223,137.231536865234],[208.049652099609,104.16431427002,138.963562011719],[210.586029052734,102.277816772461,140.594589233398],[212.595474243164,101.935104370117,143.858657836914],[215.219879150391,101.805511474609,144.279083251953],[217.477447509766,101.508125305176,144.398712158203],[219.168029785156,101.161773681641,144.441101074219],[220.365966796875,100.990867614746,145.39079284668],[220.98664855957,100.98698425293,146.357559204102],["NaN","NaN","NaN"],[220.98664855957,100.98698425293,146.357559204102],[221.829330444336,101.90404510498,147.206436157227],[223.295318603516,103.011787414551,147.066513061523],[223.886688232422,104.307151794434,147.783447265625],[224.148620605469,105.197158813477,148.499740600586],[224.477279663086,106.72388458252,148.997863769531],[224.751281738281,108.012329101562,149.541717529297],[224.758377075195,109.059310913086,151.071853637695],[224.706741333008,109.863616943359,153.587493896484],["NaN","NaN","NaN"],[220.98664855957,100.98698425293,146.357559204102],[222.117050170898,100.478881835938,145.485153198242],[223.445755004883,99.7129135131836,145.620101928711],[225.152084350586,98.6441497802734,144.821868896484],[225.748474121094,97.8278732299805,144.883773803711],[227.328033447266,96.5359954833984,144.933547973633],[228.44807434082,95.4461364746094,144.936141967773],["NaN","NaN","NaN"],[228.44807434082,95.4461364746094,144.936141967773],[228.393081665039,93.8787612915039,145.014511108398],[227.917190551758,92.5770111083984,146.114105224609],[227.528900146484,92.0755767822266,147.085800170898],["NaN","NaN","NaN"],[227.528900146484,92.0755767822266,147.085800170898],[228.128128051758,91.8148193359375,146.998184204102],[228.672149658203,91.6986465454102,147.873901367188],[229.180480957031,91.6817779541016,148.74006652832],[228.604110717773,92.6894378662109,152.570281982422],[228.842956542969,92.8712005615234,153.446380615234],[229.14826965332,92.5622406005859,154.164916992188],[229.059036254883,92.371940612793,156.528060913086],[229.634338378906,92.3063659667969,157.296997070312],["NaN","NaN","NaN"],[227.528900146484,92.0755767822266,147.085800170898],[227.411987304688,91.4955749511719,146.981964111328],[227.101715087891,91.0933380126953,147.78889465332],[226.885482788086,90.3632507324219,147.59602355957],["NaN","NaN","NaN"],[228.44807434082,95.4461364746094,144.936141967773],[231.024230957031,95.312858581543,144.849151611328],[232.315200805664,94.8095397949219,144.853271484375],[234.150329589844,94.1954116821289,144.002334594727],[235.595672607422,94.0697250366211,144.085815429688],[237.895202636719,94.3773727416992,143.30500793457],[238.861236572266,94.804313659668,143.307022094727],[239.964416503906,94.7758026123047,142.469360351562],[241.358688354492,95.0689544677734,141.674911499023],[243.926712036133,95.5653610229492,140.273834228516],[246.210296630859,96.2920684814453,139.033981323242],[247.156997680664,96.6273498535156,138.408905029297],[248.541961669922,96.7548370361328,138.508209228516],[250.583908081055,96.9142990112305,138.607391357422],["NaN","NaN","NaN"],[250.583908081055,96.9142990112305,138.607391357422],[250.427154541016,95.9882202148438,138.531311035156],[250.220550537109,95.006721496582,138.440536499023],[250.374450683594,94.3393630981445,137.6201171875],["NaN","NaN","NaN"],[250.374450683594,94.3393630981445,137.6201171875],[249.918594360352,94.0576095581055,137.585510253906],[249.886367797852,93.5907897949219,136.777954101562],["NaN","NaN","NaN"],[250.374450683594,94.3393630981445,137.6201171875],[250.789825439453,93.7299346923828,137.593185424805],[251.15022277832,92.9019012451172,137.545654296875],[251.790908813477,91.7158584594727,137.446151733398],[252.590362548828,91.0912857055664,137.369842529297],[253.009902954102,90.9490432739258,137.349212646484],["NaN","NaN","NaN"],[250.583908081055,96.9142990112305,138.607391357422],[252.032135009766,97.3359146118164,138.627426147461],[253.28987121582,97.5842590332031,137.759979248047],[254.762557983398,97.8494033813477,136.794464111328],[256.035858154297,98.4731140136719,135.719375610352],[257.776672363281,99.3431091308594,134.433334350586],[259.114471435547,100.36003112793,134.095413208008],[260.356353759766,100.782623291016,132.791961669922],[261.749481201172,100.949615478516,129.305465698242],[262.496551513672,100.34154510498,127.207939147949],[263.807434082031,99.7057647705078,122.817092895508],["NaN","NaN","NaN"],[263.807434082031,99.7057647705078,122.817092895508],[264.080108642578,98.5338973999023,121.894630432129],["NaN","NaN","NaN"],[263.807434082031,99.7057647705078,122.817092895508],[265.137298583984,100.227012634277,120.45059967041],[266.267333984375,100.097373962402,118.329460144043],["NaN","NaN","NaN"],[266.267333984375,100.097373962402,118.329460144043],[266.755706787109,99.1845474243164,116.430130004883],["NaN","NaN","NaN"],[266.755706787109,99.1845474243164,116.430130004883],[266.322326660156,98.7324066162109,116.46558380127],["NaN","NaN","NaN"],[266.755706787109,99.1845474243164,116.430130004883],[267.251617431641,98.6165084838867,112.852981567383],[267.545959472656,98.5985946655273,112.856079101562],["NaN","NaN","NaN"],[266.267333984375,100.097373962402,118.329460144043],[267.840667724609,100.283958435059,113.637725830078],[268.530181884766,101.248924255371,110.40567779541],[269.145904541016,102.610069274902,108.25862121582],[270.201416015625,104.19506072998,106.278854370117],[271.076843261719,104.952171325684,106.217269897461],[272.031951904297,104.97306060791,104.867286682129],["NaN","NaN","NaN"],[272.031951904297,104.97306060791,104.867286682129],[272.292327880859,104.184257507324,102.967262268066],["NaN","NaN","NaN"],[272.292327880859,104.184257507324,102.967262268066],[271.591247558594,103.582359313965,103.034362792969],[271.111663818359,102.91153717041,101.924781799316],[271.076171875,102.672882080078,100.849548339844],["NaN","NaN","NaN"],[272.292327880859,104.184257507324,102.967262268066],[272.824615478516,103.828681945801,104.753723144531],[273.657653808594,103.442764282227,104.034545898438],[274.804351806641,102.846878051758,103.3134765625],["NaN","NaN","NaN"],[274.804351806641,102.846878051758,103.3134765625],[274.782928466797,101.790702819824,103.291809082031],[274.612823486328,100.920608520508,103.287719726562],["NaN","NaN","NaN"],[274.804351806641,102.846878051758,103.3134765625],[275.858673095703,103.087547302246,103.293968200684],[277.783020019531,103.363876342773,103.35107421875],["NaN","NaN","NaN"],[277.783020019531,103.363876342773,103.35107421875],[277.661468505859,102.720962524414,103.330825805664],[277.391998291016,102.191482543945,102.694732666016],["NaN","NaN","NaN"],[277.783020019531,103.363876342773,103.35107421875],[278.595001220703,103.460891723633,103.409362792969],[279.563049316406,103.642593383789,103.510437011719],[280.509674072266,104.050910949707,103.045677185059],[281.401428222656,104.617446899414,103.198928833008],[282.058471679688,104.94312286377,103.905387878418],[283.268859863281,104.963638305664,104.127578735352],[284.419250488281,104.288139343262,103.748062133789],[285.179504394531,103.734275817871,102.759086608887],[285.859924316406,103.476455688477,102.910209655762],[286.461639404297,103.028648376465,103.645454406738],[286.879730224609,102.647499084473,103.764381408691],[287.091796875,102.028778076172,103.265533447266],[287.121398925781,101.433647155762,103.307395935059],["NaN","NaN","NaN"],[272.031951904297,104.97306060791,104.867286682129],[272.748596191406,105.580902099609,104.197692871094],["NaN","NaN","NaN"],[272.748596191406,105.580902099609,104.197692871094],[273.367340087891,106.484817504883,102.974548339844],[274.602416992188,106.761322021484,102.31908416748],[275.44189453125,106.179344177246,101.665237426758],[276.254364013672,106.072082519531,101.088050842285],[276.774047851562,105.310981750488,101.60913848877],[277.439239501953,104.216133117676,101.013496398926],[278.090026855469,103.440879821777,101.031890869141],[278.978912353516,101.788757324219,99.9844970703125],["NaN","NaN","NaN"],[278.978912353516,101.788757324219,99.9844970703125],[279.891235351562,100.990699768066,99.5532608032227],[280.529327392578,100.093223571777,100.192291259766],[281.184753417969,99.0961456298828,101.421264648438],[281.664825439453,97.4953460693359,101.013290405273],[281.795806884766,96.6398696899414,101.080749511719],["NaN","NaN","NaN"],[278.978912353516,101.788757324219,99.9844970703125],[278.332122802734,100.154457092285,98.8178482055664],[277.72509765625,99.0998306274414,98.7693099975586],[277.449829101562,98.2074737548828,98.748649597168],[277.039215087891,97.1171035766602,99.2676239013672],[277.007751464844,95.7465744018555,99.2436218261719],[276.655090332031,95.0980911254883,99.2211303710938],["NaN","NaN","NaN"],[272.748596191406,105.580902099609,104.197692871094],[273.912506103516,106.137252807617,102.904510498047],[274.761993408203,107.045318603516,102.915771484375],[276.154632568359,107.901779174805,103.549125671387],[277.230438232422,108.285736083984,104.19799041748],[278.224853515625,109.033409118652,104.308395385742],[278.77392578125,109.390472412109,104.379333496094],["NaN","NaN","NaN"],[278.77392578125,109.390472412109,104.379333496094],[278.723480224609,110.427398681641,103.901252746582],[278.466247558594,111.534233093262,104.586135864258],[278.113037109375,112.642295837402,104.706275939941],[278.037658691406,113.369445800781,104.801612854004],[278.328735351562,113.756271362305,104.876998901367],["NaN","NaN","NaN"],[278.77392578125,109.390472412109,104.379333496094],[279.689971923828,109.397605895996,104.465065002441],[280.672088623047,109.593238830566,104.595802307129],[281.58984375,109.833145141602,105.349281311035],[282.149841308594,110.003799438477,105.451210021973],["NaN","NaN","NaN"],[282.149841308594,110.003799438477,105.451210021973],[282.128753662109,110.752471923828,105.513481140137],[282.289215087891,111.490631103516,105.607406616211],[282.306945800781,111.93212890625,105.654922485352],["NaN","NaN","NaN"],[282.149841308594,110.003799438477,105.451210021973],[282.885650634766,109.99959564209,105.573875427246],[284.008880615234,109.715507507324,106.38452911377],[284.934112548828,109.579490661621,107.194702148438],[285.779022216797,109.807662963867,108.014106750488],[286.976013183594,109.917655944824,108.220329284668],[288.116241455078,110.611450195312,109.058784484863],[288.591552734375,110.977584838867,108.427772521973],[289.536407470703,111.960144042969,109.182807922363],["NaN","NaN","NaN"]],"colors":[[1,0,0,1]],"centers":[[186.86604309082,132.709320068359,88.2039337158203],[187.335464477539,131.155807495117,90.5968017578125],[188.116500854492,130.254455566406,93.1432571411133],[188.468032836914,129.475662231445,94.973991394043],[188.287521362305,128.754165649414,97.4562072753906],[188.27326965332,127.956718444824,99.1680145263672],[188.455825805664,127.570365905762,101.539924621582],[188.999694824219,127.539924621582,103.695404052734],[189.638244628906,126.617607116699,104.953994750977],[189.418548583984,126.125122070312,108.076599121094],[189.598403930664,125.061378479004,110.217002868652],[190.178070068359,124.265014648438,111.877548217773],[190.728012084961,123.479652404785,113.63053894043],[190.993560791016,122.456298828125,116.218589782715],[191.16667175293,121.14119720459,118.817932128906],[191.57307434082,119.000396728516,121.628929138184],[192.271179199219,116.622085571289,122.814872741699],[193.053131103516,115.116348266602,125.263648986816],[194.768920898438,112.995140075684,128.049270629883],[195.911666870117,112.014183044434,129.455596923828],[197.163696289062,111.617515563965,131.918121337891],[198.820327758789,110.203086853027,133.30647277832],[199.980117797852,108.940093994141,134.333465576172],[201.414489746094,108.122100830078,136.253784179688],[202.689422607422,106.68350982666,136.04573059082],[205.341003417969,105.654823303223,137.231536865234],[208.049652099609,104.16431427002,138.963562011719],[210.586029052734,102.277816772461,140.594589233398],[212.595474243164,101.935104370117,143.858657836914],[215.219879150391,101.805511474609,144.279083251953],[217.477447509766,101.508125305176,144.398712158203],[219.168029785156,101.161773681641,144.441101074219],[220.365966796875,100.990867614746,145.39079284668],[220.98664855957,100.98698425293,146.357559204102],["NaN","NaN","NaN"],[220.98664855957,100.98698425293,146.357559204102],[221.829330444336,101.90404510498,147.206436157227],[223.295318603516,103.011787414551,147.066513061523],[223.886688232422,104.307151794434,147.783447265625],[224.148620605469,105.197158813477,148.499740600586],[224.477279663086,106.72388458252,148.997863769531],[224.751281738281,108.012329101562,149.541717529297],[224.758377075195,109.059310913086,151.071853637695],[224.706741333008,109.863616943359,153.587493896484],["NaN","NaN","NaN"],[220.98664855957,100.98698425293,146.357559204102],[222.117050170898,100.478881835938,145.485153198242],[223.445755004883,99.7129135131836,145.620101928711],[225.152084350586,98.6441497802734,144.821868896484],[225.748474121094,97.8278732299805,144.883773803711],[227.328033447266,96.5359954833984,144.933547973633],[228.44807434082,95.4461364746094,144.936141967773],["NaN","NaN","NaN"],[228.44807434082,95.4461364746094,144.936141967773],[228.393081665039,93.8787612915039,145.014511108398],[227.917190551758,92.5770111083984,146.114105224609],[227.528900146484,92.0755767822266,147.085800170898],["NaN","NaN","NaN"],[227.528900146484,92.0755767822266,147.085800170898],[228.128128051758,91.8148193359375,146.998184204102],[228.672149658203,91.6986465454102,147.873901367188],[229.180480957031,91.6817779541016,148.74006652832],[228.604110717773,92.6894378662109,152.570281982422],[228.842956542969,92.8712005615234,153.446380615234],[229.14826965332,92.5622406005859,154.164916992188],[229.059036254883,92.371940612793,156.528060913086],[229.634338378906,92.3063659667969,157.296997070312],["NaN","NaN","NaN"],[227.528900146484,92.0755767822266,147.085800170898],[227.411987304688,91.4955749511719,146.981964111328],[227.101715087891,91.0933380126953,147.78889465332],[226.885482788086,90.3632507324219,147.59602355957],["NaN","NaN","NaN"],[228.44807434082,95.4461364746094,144.936141967773],[231.024230957031,95.312858581543,144.849151611328],[232.315200805664,94.8095397949219,144.853271484375],[234.150329589844,94.1954116821289,144.002334594727],[235.595672607422,94.0697250366211,144.085815429688],[237.895202636719,94.3773727416992,143.30500793457],[238.861236572266,94.804313659668,143.307022094727],[239.964416503906,94.7758026123047,142.469360351562],[241.358688354492,95.0689544677734,141.674911499023],[243.926712036133,95.5653610229492,140.273834228516],[246.210296630859,96.2920684814453,139.033981323242],[247.156997680664,96.6273498535156,138.408905029297],[248.541961669922,96.7548370361328,138.508209228516],[250.583908081055,96.9142990112305,138.607391357422],["NaN","NaN","NaN"],[250.583908081055,96.9142990112305,138.607391357422],[250.427154541016,95.9882202148438,138.531311035156],[250.220550537109,95.006721496582,138.440536499023],[250.374450683594,94.3393630981445,137.6201171875],["NaN","NaN","NaN"],[250.374450683594,94.3393630981445,137.6201171875],[249.918594360352,94.0576095581055,137.585510253906],[249.886367797852,93.5907897949219,136.777954101562],["NaN","NaN","NaN"],[250.374450683594,94.3393630981445,137.6201171875],[250.789825439453,93.7299346923828,137.593185424805],[251.15022277832,92.9019012451172,137.545654296875],[251.790908813477,91.7158584594727,137.446151733398],[252.590362548828,91.0912857055664,137.369842529297],[253.009902954102,90.9490432739258,137.349212646484],["NaN","NaN","NaN"],[250.583908081055,96.9142990112305,138.607391357422],[252.032135009766,97.3359146118164,138.627426147461],[253.28987121582,97.5842590332031,137.759979248047],[254.762557983398,97.8494033813477,136.794464111328],[256.035858154297,98.4731140136719,135.719375610352],[257.776672363281,99.3431091308594,134.433334350586],[259.114471435547,100.36003112793,134.095413208008],[260.356353759766,100.782623291016,132.791961669922],[261.749481201172,100.949615478516,129.305465698242],[262.496551513672,100.34154510498,127.207939147949],[263.807434082031,99.7057647705078,122.817092895508],["NaN","NaN","NaN"],[263.807434082031,99.7057647705078,122.817092895508],[264.080108642578,98.5338973999023,121.894630432129],["NaN","NaN","NaN"],[263.807434082031,99.7057647705078,122.817092895508],[265.137298583984,100.227012634277,120.45059967041],[266.267333984375,100.097373962402,118.329460144043],["NaN","NaN","NaN"],[266.267333984375,100.097373962402,118.329460144043],[266.755706787109,99.1845474243164,116.430130004883],["NaN","NaN","NaN"],[266.755706787109,99.1845474243164,116.430130004883],[266.322326660156,98.7324066162109,116.46558380127],["NaN","NaN","NaN"],[266.755706787109,99.1845474243164,116.430130004883],[267.251617431641,98.6165084838867,112.852981567383],[267.545959472656,98.5985946655273,112.856079101562],["NaN","NaN","NaN"],[266.267333984375,100.097373962402,118.329460144043],[267.840667724609,100.283958435059,113.637725830078],[268.530181884766,101.248924255371,110.40567779541],[269.145904541016,102.610069274902,108.25862121582],[270.201416015625,104.19506072998,106.278854370117],[271.076843261719,104.952171325684,106.217269897461],[272.031951904297,104.97306060791,104.867286682129],["NaN","NaN","NaN"],[272.031951904297,104.97306060791,104.867286682129],[272.292327880859,104.184257507324,102.967262268066],["NaN","NaN","NaN"],[272.292327880859,104.184257507324,102.967262268066],[271.591247558594,103.582359313965,103.034362792969],[271.111663818359,102.91153717041,101.924781799316],[271.076171875,102.672882080078,100.849548339844],["NaN","NaN","NaN"],[272.292327880859,104.184257507324,102.967262268066],[272.824615478516,103.828681945801,104.753723144531],[273.657653808594,103.442764282227,104.034545898438],[274.804351806641,102.846878051758,103.3134765625],["NaN","NaN","NaN"],[274.804351806641,102.846878051758,103.3134765625],[274.782928466797,101.790702819824,103.291809082031],[274.612823486328,100.920608520508,103.287719726562],["NaN","NaN","NaN"],[274.804351806641,102.846878051758,103.3134765625],[275.858673095703,103.087547302246,103.293968200684],[277.783020019531,103.363876342773,103.35107421875],["NaN","NaN","NaN"],[277.783020019531,103.363876342773,103.35107421875],[277.661468505859,102.720962524414,103.330825805664],[277.391998291016,102.191482543945,102.694732666016],["NaN","NaN","NaN"],[277.783020019531,103.363876342773,103.35107421875],[278.595001220703,103.460891723633,103.409362792969],[279.563049316406,103.642593383789,103.510437011719],[280.509674072266,104.050910949707,103.045677185059],[281.401428222656,104.617446899414,103.198928833008],[282.058471679688,104.94312286377,103.905387878418],[283.268859863281,104.963638305664,104.127578735352],[284.419250488281,104.288139343262,103.748062133789],[285.179504394531,103.734275817871,102.759086608887],[285.859924316406,103.476455688477,102.910209655762],[286.461639404297,103.028648376465,103.645454406738],[286.879730224609,102.647499084473,103.764381408691],[287.091796875,102.028778076172,103.265533447266],[287.121398925781,101.433647155762,103.307395935059],["NaN","NaN","NaN"],[272.031951904297,104.97306060791,104.867286682129],[272.748596191406,105.580902099609,104.197692871094],["NaN","NaN","NaN"],[272.748596191406,105.580902099609,104.197692871094],[273.367340087891,106.484817504883,102.974548339844],[274.602416992188,106.761322021484,102.31908416748],[275.44189453125,106.179344177246,101.665237426758],[276.254364013672,106.072082519531,101.088050842285],[276.774047851562,105.310981750488,101.60913848877],[277.439239501953,104.216133117676,101.013496398926],[278.090026855469,103.440879821777,101.031890869141],[278.978912353516,101.788757324219,99.9844970703125],["NaN","NaN","NaN"],[278.978912353516,101.788757324219,99.9844970703125],[279.891235351562,100.990699768066,99.5532608032227],[280.529327392578,100.093223571777,100.192291259766],[281.184753417969,99.0961456298828,101.421264648438],[281.664825439453,97.4953460693359,101.013290405273],[281.795806884766,96.6398696899414,101.080749511719],["NaN","NaN","NaN"],[278.978912353516,101.788757324219,99.9844970703125],[278.332122802734,100.154457092285,98.8178482055664],[277.72509765625,99.0998306274414,98.7693099975586],[277.449829101562,98.2074737548828,98.748649597168],[277.039215087891,97.1171035766602,99.2676239013672],[277.007751464844,95.7465744018555,99.2436218261719],[276.655090332031,95.0980911254883,99.2211303710938],["NaN","NaN","NaN"],[272.748596191406,105.580902099609,104.197692871094],[273.912506103516,106.137252807617,102.904510498047],[274.761993408203,107.045318603516,102.915771484375],[276.154632568359,107.901779174805,103.549125671387],[277.230438232422,108.285736083984,104.19799041748],[278.224853515625,109.033409118652,104.308395385742],[278.77392578125,109.390472412109,104.379333496094],["NaN","NaN","NaN"],[278.77392578125,109.390472412109,104.379333496094],[278.723480224609,110.427398681641,103.901252746582],[278.466247558594,111.534233093262,104.586135864258],[278.113037109375,112.642295837402,104.706275939941],[278.037658691406,113.369445800781,104.801612854004],[278.328735351562,113.756271362305,104.876998901367],["NaN","NaN","NaN"],[278.77392578125,109.390472412109,104.379333496094],[279.689971923828,109.397605895996,104.465065002441],[280.672088623047,109.593238830566,104.595802307129],[281.58984375,109.833145141602,105.349281311035],[282.149841308594,110.003799438477,105.451210021973],["NaN","NaN","NaN"],[282.149841308594,110.003799438477,105.451210021973],[282.128753662109,110.752471923828,105.513481140137],[282.289215087891,111.490631103516,105.607406616211],[282.306945800781,111.93212890625,105.654922485352],["NaN","NaN","NaN"],[282.149841308594,110.003799438477,105.451210021973],[282.885650634766,109.99959564209,105.573875427246],[284.008880615234,109.715507507324,106.38452911377],[284.934112548828,109.579490661621,107.194702148438],[285.779022216797,109.807662963867,108.014106750488],[286.976013183594,109.917655944824,108.220329284668],[288.116241455078,110.611450195312,109.058784484863],[288.591552734375,110.977584838867,108.427772521973],[289.536407470703,111.960144042969,109.182807922363],["NaN","NaN","NaN"]],"ignoreExtent":false,"flags":32832},"11":{"id":11,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"10":{"id":10,"type":"background","material":{},"colors":[[0.298039227724075,0.298039227724075,0.298039227724075,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"12":{"id":12,"type":"background","material":{"lit":false,"back":"lines"},"colors":[[1,1,1,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"15":{"id":15,"type":"background","material":{"lit":false,"back":"lines"},"colors":[[0.82745099067688,0.82745099067688,0.82745099067688,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","fogscale":1,"flags":32768},"7":{"id":7,"type":"subscene","par3d":{"antialias":8,"FOV":30,"ignoreExtent":false,"listeners":7,"mouseMode":{"none":"none","left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,252.683288574219],"modelMatrix":[[1,0,0,-238.201232910156],[0,0.342020153999329,0.939692616462708,-153.495361328125],[0,-0.939692616462708,0.342020153999329,-189.856597900391],[0,0,0,1]],"projMatrix":[[3.73205065727234,0,0,0],[0,3.73205065727234,0,0],[0,0,-3.86370372772217,-910.894104003906],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.342020143325668,0.939692620785909,0],[0,-0.939692620785909,0.342020143325668,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[186.86604309082,289.536407470703,90.3632507324219,132.709320068359,88.2039337158203,157.296997070312],"windowRect":[120,165,376,421],"family":"sans","font":1,"cex":1,"useFreeType":true,"fontname":"/Library/Frameworks/R.framework/Versions/4.1/Resources/library/rgl/fonts/FreeSans.ttf","maxClipPlanes":6,"glVersion":2.1,"activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[15,13,14,11],"subscenes":[],"flags":35136}},"crosstalk":{"key":[],"group":[],"id":[],"options":[]},"width":480,"height":432.632880098888,"context":{"shiny":false,"rmarkdown":"rmarkdown::html_vignette"},"players":[],"webGLoptions":{"preserveDrawingBuffer":true}},"evals":[],"jsHooks":[]}</script><p>You should be able to rotate (click and drag) and zoom (mouse wheel) this figure.</p>
<p>Since this results in quite large html files when used with many neurons, we will not use it further here. For now let’s show a plot in which we both select a subset of neurons and colour them according to their glomerulus of origin.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 3d plot of neurons from olfactory glomeruli beginning with a D</span>
<span class="co"># coloured by glomerulus</span>
<span class="va">rval</span><span class="op">=</span><span class="fu"><a href="../reference/plot3d.html">plot3d</a></span><span class="op">(</span><span class="va">Cell07PNs</span>, subset<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^D"</span>, <span class="va">Glomerulus</span><span class="op">)</span>, col<span class="op">=</span><span class="va">Glomerulus</span>,
  lwd<span class="op">=</span><span class="fl">2</span>, WithNodes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-32-1.png" width="576"></p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make a legend so that you know which colours match which glomerulus</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/frame.html">plot.new</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/neuronlist-dataframe-methods.html">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">rval</span>,<span class="st">'df'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">'center'</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">Glomerulus</span><span class="op">)</span>, fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/plot3d-legend-1.png" width="288"></p>
</div>
</div>
<div id="putting-it-all-together" class="section level2">
<h2 class="hasAnchor">
<a href="#putting-it-all-together" class="anchor"></a>Putting it all together</h2>
<p>To close this tutorial, let’s do some morphological analysis of the neurons in this dataset. There are second order olfactory projection neurons originating from 4 different glomeruli in the <code>Cell07PNs</code> sample dataset, each coming from a different animal. We can ask whether their axon terminal arborisations in a brain area called the lateral horn show any features that are distinctive for different classes. This would be consistent with the hypothesis that information from different glomeruli (i.e. olfactory channels) is handled in a stereotyped way in this brain area.</p>
<p>Let’s start by cutting out the arbour within the lateral horn from all of the neurons. We’ll use a very simple approach of cutting at X=250, although <strong>nat</strong> has more sophisticated ways to do this e.g. by using 3D spaces defined by a surface mesh.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># note that we had to use OmitFailures=T due to a problem with the graph</span>
<span class="co"># structure of one neuron</span>
<span class="va">lha</span><span class="op">=</span><span class="fu"><a href="../reference/nlapply.html">nlapply</a></span><span class="op">(</span><span class="va">Cell07PNs</span>, <span class="va">subset</span>, <span class="va">X</span><span class="op">&gt;</span><span class="fl">250</span>, OmitFailures <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="co"># Let's plot what we have colouring by glomerulus</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lha</span>, col<span class="op">=</span><span class="va">Glomerulus</span>, WithNodes<span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-33-1.png" width="480"></p>
<p>Now we can get a basic statistical summary by axon arbour.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lhstats</span><span class="op">=</span><span class="fu"><a href="../reference/summary.neuronlist.html">summary</a></span><span class="op">(</span><span class="va">lha</span>, include.attached.dataframe <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">lhstats</span><span class="op">$</span><span class="va">cable.length</span><span class="op">~</span><span class="va">lhstats</span><span class="op">$</span><span class="va">Glomerulus</span>, log<span class="op">=</span><span class="st">'y'</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-34-1.png" width="480"></p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">lhstats</span><span class="op">$</span><span class="va">branchpoints</span><span class="op">~</span><span class="va">lhstats</span><span class="op">$</span><span class="va">Glomerulus</span><span class="op">)</span></code></pre></div>
<p><img src="neurons-intro_files/figure-html/unnamed-chunk-34-2.png" width="480"></p>
<p>We can also calculate the median position of the arbour for each neuron and add that to the lhstats database</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># quick function to calculate centroid</span>
<span class="va">arbour_centroid</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># extract location of all points in neuron object</span>
  <span class="va">xyzs</span><span class="op">=</span><span class="fu"><a href="../reference/xyzmatrix.html">xyzmatrix</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
  <span class="co"># median in all 3 axes (=&gt;2 columns)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">xyzs</span>, <span class="fl">2</span>, <span class="va">median</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># note that we have to transpose because sapply results in x,y,z rows</span>
<span class="va">centroids</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">lha</span>, <span class="va">arbour_centroid</span><span class="op">)</span><span class="op">)</span>
<span class="va">lhstats</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">lhstats</span>, <span class="va">centroids</span><span class="op">)</span></code></pre></div>
<p>Finally we can take these data and see how well we can predict the identity of the neuron (i.e. its glomerulus) based on the statistics of the axon arbour in the lateral horn. We use the linear discriminant analysis (provided by the function <code>lda</code> in recommended package <code>MASS</code>). This also runs a leave one out cross-validation to get a more robust initial estimate of prediction error.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span>
<span class="va">lda.fit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lda.html">lda</a></span><span class="op">(</span><span class="va">Glomerulus</span> <span class="op">~</span> <span class="va">cable.length</span><span class="op">+</span><span class="va">X</span><span class="op">+</span><span class="va">Y</span><span class="op">+</span><span class="va">Z</span><span class="op">+</span><span class="va">branchpoints</span>, <span class="va">lhstats</span>, CV <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">lda.fit</span><span class="op">$</span><span class="va">class</span>, <span class="va">lhstats</span><span class="op">$</span><span class="va">Glomerulus</span><span class="op">)</span></code></pre></div>
<pre><code>##       
##        DA1 DL3 DP1m VA1d
##   DA1   10   2    0    1
##   DL3    0   7    0    0
##   DP1m   0   0    8    0
##   VA1d   1   0    0   10</code></pre>
<p>The prediction accuracy of 35/39 i.e. just under 90% is already very good compared with a chance level of about 25% for these 4 classes.</p>
</div>
<div id="learning-more" class="section level2">
<h2 class="hasAnchor">
<a href="#learning-more" class="anchor"></a>Learning More</h2>
<p>We hope this tutorial will provide you with a good foundation for further use of the <strong>nat</strong> and related packages. Please visit the main <a href="http://natverse.org/nat/index.html">nat README</a> for suggestions of resources to learn more and solve problems. You may also find that some time spent reading Hadley Wickham’s <a href="http://adv-r.had.co.nz/">Advanced R</a> is a worthwhile investment. I recommend the first 7 chapters (Introduction to OO field guide) as material that will be helpful for anyone who intends to carry out a significant project using R.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gregory Jefferis, James Manton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
