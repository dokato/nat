<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>neuronlistfh - List of neurons loaded on demand from disk or remote website — neuronlistfh • nat</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="neuronlistfh - List of neurons loaded on demand from disk or remote website — neuronlistfh" />
<meta property="og:description" content="neuronlistfh objects consist of a list of neuron objects 
  along with an optional attached dataframe containing information about the 
  neurons. In contrast to neuronlist objects the neurons are not 
  present in memory but are instead dynamically loaded from disk as required.
  neuronlistfh objects also inherit from neuronlist and 
  therefore any appropriate methods e.g. plot3d.neuronlist can also be
  used on neuronlistfh objects.  
neuronlistfh constructs a neuronlistfh object from a 
  filehash, data.frame and keyfilemap. End users will 
  not typically use this function to make a neuronlistfh. 
  They will usually read them using read.neuronlistfh and sometimes 
  create them by using as.neuronlistfh on a neuronlist object.
is.neuronlistfh test if an object is a neuronlistfh
as.neuronlistfh generic function to convert an object to 
  neuronlistfh
as.neuronlistfh.neuronlist converts a regular neuronlist 
  to one backed by a filehash object with an on disk representation" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.8.17</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Installation.html">Installation Details</a>
    </li>
    <li>
      <a href="../articles/neurons-intro.html">Introduction to neurons and neuronlists</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/natverse/nat/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>neuronlistfh - List of neurons loaded on demand from disk or remote website</h1>
    <small class="dont-index">Source: <a href='https://github.com/natverse/nat/blob/master/R/neuronlistfh.R'><code>R/neuronlistfh.R</code></a></small>
    <div class="hidden name"><code>neuronlistfh.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>neuronlistfh</code> objects consist of a list of neuron objects 
  along with an optional attached dataframe containing information about the 
  neurons. In contrast to <code>neuronlist</code> objects the neurons are not 
  present in memory but are instead dynamically loaded from disk as required.
  <code>neuronlistfh</code> objects also inherit from <code>neuronlist</code> and 
  therefore any appropriate methods e.g. <code>plot3d.neuronlist</code> can also be
  used on <code>neuronlistfh</code> objects.</p>  
<p><code>neuronlistfh</code> constructs a neuronlistfh object from a 
  <code>filehash</code>, <code>data.frame</code> and <code>keyfilemap</code>. End users will 
  <strong>not</strong> typically use this function to make a <code>neuronlistfh</code>. 
  They will usually read them using <code>read.neuronlistfh</code> and sometimes 
  create them by using <code>as.neuronlistfh</code> on a <code>neuronlist</code> object.</p>
<p><code>is.neuronlistfh</code> test if an object is a neuronlistfh</p>
<p><code>as.neuronlistfh</code> generic function to convert an object to 
  neuronlistfh</p>
<p><code>as.neuronlistfh.neuronlist</code> converts a regular neuronlist 
  to one backed by a filehash object with an on disk representation</p>
    </div>

    <pre class="usage"><span class='fu'>neuronlistfh</span><span class='op'>(</span><span class='va'>db</span>, <span class='va'>df</span>, <span class='va'>keyfilemap</span>, hashmap <span class='op'>=</span> <span class='fl'>1000L</span><span class='op'>)</span>

<span class='fu'>is.neuronlistfh</span><span class='op'>(</span><span class='va'>nl</span><span class='op'>)</span>

<span class='fu'>as.neuronlistfh</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>df</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for neuronlist</span>
<span class='fu'>as.neuronlistfh</span><span class='op'>(</span>
  <span class='va'>x</span>,
  df <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='st'>"df"</span><span class='op'>)</span>,
  dbdir <span class='op'>=</span> <span class='cn'>NULL</span>,
  dbClass <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"RDS"</span>, <span class='st'>"RDS2"</span><span class='op'>)</span>,
  remote <span class='op'>=</span> <span class='cn'>NULL</span>,
  WriteObjects <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"yes"</span>, <span class='st'>"no"</span>, <span class='st'>"missing"</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>db</th>
      <td><p>a <code>filehash</code> object that manages an on disk database of neuron
objects. See Implementation details.</p></td>
    </tr>
    <tr>
      <th>df</th>
      <td><p>Optional dataframe, where each row describes one neuron</p></td>
    </tr>
    <tr>
      <th>keyfilemap</th>
      <td><p>A named character vector in which the elements are 
filenames on disk (managed by the filehash object) and the names are the 
keys used in R to refer to the neuron objects. Note that the keyfilemap 
defines the order of objects in the neuronlist and will be used to reorder 
the dataframe if necessary.</p></td>
    </tr>
    <tr>
      <th>hashmap</th>
      <td><p>A logical indicating whether to add a hashed environment for 
rapid object lookup by name or an integer or an integer definining a 
threhsold number of objects when this will happen (see Implementation 
details).</p></td>
    </tr>
    <tr>
      <th>nl</th>
      <td><p>Object to test</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>Object to convert</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments for methods, eventually passed to
<code>neuronlistfh()</code> constructor.</p></td>
    </tr>
    <tr>
      <th>dbdir</th>
      <td><p>The path to the underlying <code>filehash</code> database on disk. By
convention this should be a path whose final element is 'data'</p></td>
    </tr>
    <tr>
      <th>dbClass</th>
      <td><p>The <code>filehash</code> database class. Defaults to <code>RDS</code>.</p></td>
    </tr>
    <tr>
      <th>remote</th>
      <td><p>The url pointing to a remote repository containing files for 
each neuron.</p></td>
    </tr>
    <tr>
      <th>WriteObjects</th>
      <td><p>Whether to write objects to disk. Missing implies that 
existing objects will not be overwritten. Default <code>"yes"</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a <code>neuronlistfh</code> object which is a character <code>vector</code> with 
  classes <code>neuronlistfh, neuronlist</code> and attributes <code>db, df</code>. See 
  Implementation details.</p>
    <h2 class="hasAnchor" id="implementation-details"><a class="anchor" href="#implementation-details"></a>Implementation details</h2>

    <p>neuronlistfh objects are a hybrid between 
  regular <code>neuronlist</code> objects that organise data and metadata for 
  collections of neurons and a backing <code>filehash</code> object. Instead of 
  keeping objects in memory, they are <em>always</em> loaded from disk. 
  Although this sounds like it might be slow, for nearly all practical 
  purposes (e.g. plotting neurons) the time to read the neuron from disk is 
  small compared with the time to plot the neuron; the OS will cache repeated
  reads of the same file. The benefits in memory and startup time (&lt;1s vs 
  100s for our 16,000 neuron database) are vital for collections of 1000s of 
  neurons e.g. for dynamic report generation using knitr or for users with 
  &lt;8Gb RAM or running 32 bit R.</p>  
<p>neuronlistfh objects include:</p><ul>
<li><p>attr("keyfilemap") A named character vector that determines the 
  ordering of objects in the neuronlist and translates keys in R to filenames
  on disk. For objects created by <code>as.neuronlistfh</code> the filenames will 
  be the md5 hash of the object as calculated using <code>digest</code>. This 
  design means that the same key can be used to refer to multiple distinct 
  objects on disk. Objects are effecitvely versioned by their contents. So if
  an updated neuronlistfh object is posted to a website and then fetched by a
  user it will result in the automated download of any updated objects to 
  which it refers.</p></li>
<li><p>attr("db") The backing database - typically of class 
  <code>filehashRDS</code>. This manages the loading of objects from disk.</p></li>
<li><p>attr(x,"df") The data.frame of metadata which can be used to select
  and plot neurons. See <code><a href='neuronlist.html'>neuronlist</a></code> for examples.</p></li>
<li><p>attr(x,"hashmap") (Optional) a hashed environment which can be used
  for rapid lookup using key names (rather than numeric/logical indices). 
  There is a space potential to pay for this redundant lookup method, but it 
  is normally worth while given that the dataframe object is typically 
  considerably larger. To give some numbers, the additional environment might
  occupy ~ 1<!-- % of a 16,000 object neuronlistfh object and reduce mean lookup  -->
  time from 0.5 ms to 1us. Having located the object, on my machine it can 
  take as little as 0.1ms to load from disk, so these savings are relevant.</p></li>
</ul>
  
<p>Presently only backing objects which extend the <code>filehash</code> class are 
  supported (although in theory other backing objects could be added). These 
  include:</p><ul>
<li><p>filehash RDS</p></li>
<li><p>filehash RDS2 (experimental)</p></li>
</ul>
  
<p>We have also implemented a simple remote access protocol (currently only 
  for the <code>RDS</code> format). This allows a neuronlistfh object to be read 
  from a url and downloaded to a local path. Subsequent attempts to access 
  neurons stored in this list will result in automated download of the 
  requested neuron to the local cache.</p>  
<p>An alternative backend, the experimental <code>RDS2</code> format is supported 
  (available at <a href='https://github.com/jefferis/filehash'>https://github.com/jefferis/filehash</a>). This is likely 
  to be the most effective for large (5,000-500,000) collections of neurons, 
  especially when using network filesystems (nfs, afp) which are typically 
  very slow at listing large directories.</p>  
<p>Note that objects are stored in a filehash, which by definition does not 
  have any ordering of its elements. However neuronlist objects (like lists) 
  do have an ordering. Therefore the names of a neuronlistfh object are not 
  necessarily the same as the result of calling <code><a href='https://rdrr.io/r/base/names.html'>names()</a></code> on the 
  underlying filehash object.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/pkg/filehash/man/filehash-class.html'>filehash-class</a></code></p>
<p>Other neuronlistfh: 
<code><a href='[.neuronlistfh.html'>[.neuronlistfh</a>()</code>,
<code><a href='read.neuronlistfh.html'>read.neuronlistfh</a>()</code>,
<code><a href='remotesync.html'>remotesync</a>()</code>,
<code><a href='write.neuronlistfh.html'>write.neuronlistfh</a>()</code></p>
<p>Other neuronlist: 
<code><a href='*.neuronlist.html'>*.neuronlist</a>()</code>,
<code><a href='is.neuronlist.html'>is.neuronlist</a>()</code>,
<code><a href='neuronlist-dataframe-methods.html'>neuronlist-dataframe-methods</a></code>,
<code><a href='neuronlist.html'>neuronlist</a>()</code>,
<code><a href='nlapply.html'>nlapply</a>()</code>,
<code><a href='read.neurons.html'>read.neurons</a>()</code>,
<code><a href='write.neurons.html'>write.neurons</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='va'>kcnl</span><span class='op'>=</span><span class='fu'><a href='read.neuronlistfh.html'>read.neuronlistfh</a></span><span class='op'>(</span><span class='st'>'http://jefferislab.org/si/nblast/flycircuit/kcs20.rds'</span>,
<span class='st'>'path/to/my/project/folder'</span><span class='op'>)</span>
<span class='co'># this will automatically download the neurons from the web the first time</span>
<span class='co'># it is run</span>
<span class='fu'><a href='plot3d.html'>plot3d</a></span><span class='op'>(</span><span class='va'>kcnl</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># create neuronlistfh object backed by filehash with one file per neuron</span>
<span class='co'># by convention we create a subfolder called data in which the objects live</span>
<span class='va'>kcs20fh</span><span class='op'>=</span><span class='fu'>as.neuronlistfh</span><span class='op'>(</span><span class='va'>kcs20</span>, dbdir<span class='op'>=</span><span class='st'>'/path/to/my/kcdb/data'</span><span class='op'>)</span>
<span class='fu'><a href='plot3d.html'>plot3d</a></span><span class='op'>(</span><span class='fu'><a href='subset.html'>subset</a></span><span class='op'>(</span><span class='va'>kcs20fh</span>,<span class='va'>type</span><span class='op'>==</span><span class='st'>'gamma'</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># ... and, again by convention, save the neuronlisfh object next to filehash </span>
<span class='co'># backing database</span>
<span class='fu'><a href='write.neuronlistfh.html'>write.neuronlistfh</a></span><span class='op'>(</span><span class='va'>kcs20fh</span>, file<span class='op'>=</span><span class='st'>'/path/to/my/kcdb/kcdb.rds'</span><span class='op'>)</span>

<span class='co'># in a new session</span>
<span class='fu'><a href='read.neuronlistfh.html'>read.neuronlistfh</a></span><span class='op'>(</span><span class='st'>"/path/to/my/kcdb/kcdb.rds"</span><span class='op'>)</span>
<span class='fu'><a href='plot3d.html'>plot3d</a></span><span class='op'>(</span><span class='fu'><a href='subset.html'>subset</a></span><span class='op'>(</span><span class='va'>kcs20fh</span>, <span class='va'>type</span><span class='op'>==</span><span class='st'>'gamma'</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Gregory Jefferis, James Manton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


